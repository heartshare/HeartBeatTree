# HeatBeatTree
心跳技术研究


<pre>
Heatbeat
        Heatbeat可以将资源（IP和应用程序）从一台故障服务器转移到另一台运转正常的机器继续提供
     服务，在实际生产应用场景中，HeatBeat的功能和另一个高可用开源软件Keepalived有很多相同之处。
</pre>

<pre>
HeatBeat工作原理

     主备模式：

         通过修改配置文件，指定哪一台HeatBeat服务器作为主服务器，则另一台将自动成为本分服务器
     。然后在指定备份服务器上配置HeatBeat守护进程来监听来来自主服务器的心跳。如果备份服务器在指定
     时间内未监听到来自主服务器的心跳，就会启动故障转移程序，并取得主服务器上的相关资源所有权，接
     替主服务器继续不间断的提供服务，从而达到资源服务高可用的目的。

     
     主主模式
         即两台服务器互为主备，这时他们之间会相互发送报文来告诉对方他们各自的状态，如果在指定的时
     间内未收到对方发送的心跳报文，那么就认为对方失效或者宕机了，这时就会启动自身的资源接管模块来
     运行在对方主机上的资源或者服务，继续对用户提供服务，正常情况下，可以较好的实现主机故障后，业
     务不间断。
</pre>

<pre>
Heartbeat消息类型
    Heartbeat软件在工作过程中，一般来说，有三种消息类型，具体为
    
       1）心跳消息
          心跳消息为约150字节的数据包，可能为单播、广播或多播的方式，控制心跳频率及出现故障要等
       待多久进行故障转换

       2）集群转换消息
          ip-request和ip-request-resp
          当主服务器恢复在线状态时，通过ip-request消息要求备机释放主服务器失败时备服务器取得
       的资源，然后备份服务器关闭释放主服务器失败时取得的资源及服务

          备服务器释放主服务器失败时取得的资源及服务后，就会通过ip-request-resp消息通知主服务
       器它不在拥有该资源及服务，主服务器收到来自备节点的ip-request-resp消息通知后，启动失败
       时释放的资源及服务，并开始提供正常的访问服务

       3）重传请求
</pre>

<pre>
HeartBeat IP地址接管和故障转移
           
           Heartbeat是通过IP地址接管和ARP广播进行故障转移的。

           ARP广播：
                  在主服务器故障时，备节点接管资源后，会立即强制更新所有客户端本地的ARP表（即
           清除客户端本地缓存中的失败服务器的IP地址和MAC地址的解析记录），确保客户端和新的主机
           通信。
</pre>